extends layout.pug

block title

block sorters
    each card in data
        table(width="100%")
            tbody
                tr
                    td(rowspan=2 width="5%")
                        i(class='ss ss-' + card.set.code + ' ss-' + card.rarity.name.toLowerCase() + ' ss-2x')
                    td(width="15%") #{card.set.name} (#{card.set.code})
                    td(width="85%" align="right")
                        h3
                            i(class="language icon")
                            .mini.ui.buttons
                                if card.language.code == "en"
                                    .ui.button.disabled EN
                                else
                                    each other_language in card.other_languages
                                        if other_language.language.code == "en"
                                            a(href="/card/" + other_language.id + "?displayAs=" + displayAs + "&sortedBy=" + sortedBy + "&orderBy=" + orderBy)
                                                .ui.button EN

                                if card.language.code == "es"
                                    .ui.button.disabled ES
                                else
                                    each other_language in card.other_languages
                                        if other_language.language.code == "es"
                                            a(href="/card/" + other_language.id + "?displayAs=" + displayAs + "&sortedBy=" + sortedBy + "&orderBy=" + orderBy)
                                                .ui.button ES

                                if card.language.code == "fr"
                                    .ui.button.disabled FR
                                else
                                    each other_language in card.other_languages
                                        if other_language.language.code == "fr"
                                            a(href="/card/" + other_language.id + "?displayAs=" + displayAs + "&sortedBy=" + sortedBy + "&orderBy=" + orderBy)
                                                .ui.button FR

                                if card.language.code == "de"
                                    .ui.button.disabled DE
                                else
                                    each other_language in card.other_languages
                                        if other_language.language.code == "de"
                                            a(href="/card/" + other_language.id + "?displayAs=" + displayAs + "&sortedBy=" + sortedBy + "&orderBy=" + orderBy)
                                                .ui.button DE

                                if card.language.code == "it"
                                    .ui.button.disabled IT
                                else
                                    each other_language in card.other_languages
                                        if other_language.language.code == "it"
                                            a(href="/card/" + other_language.id + "?displayAs=" + displayAs + "&sortedBy=" + sortedBy + "&orderBy=" + orderBy)
                                                .ui.button IT

                                if card.language.code == "pt"
                                    .ui.button.disabled PT
                                else
                                    each other_language in card.other_languages
                                        if other_language.language.code == "pt"
                                            a(href="/card/" + other_language.id + "?displayAs=" + displayAs + "&sortedBy=" + sortedBy + "&orderBy=" + orderBy)
                                                .ui.button PT

                                if card.language.code == "ja"
                                    .ui.button.disabled JA
                                else
                                    each other_language in card.other_languages
                                        if other_language.language.code == "ja"
                                            a(href="/card/" + other_language.id + "?displayAs=" + displayAs + "&sortedBy=" + sortedBy + "&orderBy=" + orderBy)
                                                .ui.button JA

                                if card.language.code == "ko"
                                    .ui.button.disabled KO
                                else
                                    each other_language in card.other_languages
                                        if other_language.language.code == "ko"
                                            a(href="/card/" + other_language.id + "?displayAs=" + displayAs + "&sortedBy=" + sortedBy + "&orderBy=" + orderBy)
                                                .ui.button KO

                                if card.language.code == "ru"
                                    .ui.button.disabled RU
                                else
                                    each other_language in card.other_languages
                                        if other_language.language.code == "ru"
                                            a(href="/card/" + other_language.id + "?displayAs=" + displayAs + "&sortedBy=" + sortedBy + "&orderBy=" + orderBy)
                                                .ui.button RU

                                if card.language.code == "zhs"
                                    .ui.button.disabled 汉语
                                else
                                    each other_language in card.other_languages
                                        if other_language.language.code == "zhs"
                                            a(href="/card/" + other_language.id + "?displayAs=" + displayAs + "&sortedBy=" + sortedBy + "&orderBy=" + orderBy)
                                                .ui.button 汉语

                                if card.language.code == "zht"
                                    .ui.button.disabled 漢語
                                else
                                    each other_language in card.other_languages
                                        if other_language.language.code == "zht"
                                            a(href="/card/" + other_language.id + "?displayAs=" + displayAs + "&sortedBy=" + sortedBy + "&orderBy=" + orderBy)
                                                .ui.button 漢語
                    tr
                        td ##{card.collector_number} &#11825; #{card.rarity.name} &#11825; #{card.language.name}

block data
    .ui.items
        each card in data
            .item
                if card.faces.length > 0
                    img.ui.medium.image(src="/images/cards/" + card.set.code + "/" + card.language.code + "/" + card.faces[0].id + "/normal.jpg" alt=card.language.code == "en" ? card.name : card.printed_name)
                else
                    img.ui.medium.image(src="/images/cards/" + card.set.code + "/" + card.language.code + "/" + card.id + "/normal.jpg" alt=card.language.code == "en" ? card.name : card.printed_name)
                .content
                    if card.faces.length > 0
                        each face in card.faces
                            .header #{card.language.code == "en" ? face.name : face.printed_name} &nbsp;&nbsp;&nbsp;
                                if face.mana_cost != null
                                    each mana in  manaSymbols(face.mana_cost)
                                        if mana == "//"
                                            = mana
                                        else
                                            img(src="/images/mana/" + mana + ".svg" height="16")
                            .meta #{card.language.code == "en" ? face.type_line : face.printed_type_line}
                            if face.power || face.toughness
                                .description #{face.power} / #{face.toughness}
                            if card.language.code == "en"
                                .description !{changeManaSymbolsInText(face.oracle_text)}
                            else
                                .description !{changeManaSymbolsInText(face.printed_text)}
                            if face.flavor_text
                                .meta
                                    i #{ face.flavor_text }
                            .description Illustrated by #{card.artist.name}
                            p &nbsp;
                    else
                        .header #{card.language.code == "en" ? card.name : card.printed_name} &nbsp;&nbsp;&nbsp;
                            if card.mana_cost != null
                                each mana in  manaSymbols(card.mana_cost)
                                    if mana == "//"
                                        = mana
                                    else
                                        img(src="/images/mana/" + mana + ".svg" height="16")
                        .meta #{card.language.code == "en" ? card.type_line : card.printed_type_line}
                        if card.power || card.toughness
                            .description #{card.power} / #{card.toughness}
                        if card.language.code == "en"
                            .description !{card.oracle_text != null ? changeManaSymbolsInText(card.oracle_text) : "&nbsp;"}
                        else
                            .description !{card.printed_text != null ? changeManaSymbolsInText(card.printed_text) : "&nbsp;"}
                        if card.flavor_text
                            .meta
                                i #{ card.flavor_text }
                        .description Illustrated by #{card.artist.name}
                    .description
                        - var foilLow = 0
                        - var foilMedian = 0
                        - var foilHigh = 0
                        - var foilMarket = 0
                        - var foilDirectLow = 0
                        - var normalLow = 0
                        - var normalMedian = 0
                        - var normalHigh = 0
                        - var normalMarket = 0
                        - var normalDirectLow = 0

                        each price in card.prices
                            if price.is_foil
                                - foilLow = price.low
                                - foilMedian = price.median
                                - foilHigh = price.high
                                - foilMarket = price.market
                                - foilDirectLow = price.direct_low
                            else
                                - normalLow = price.low
                                - normalMedian = price.median
                                - normalHigh = price.high
                                - normalMarket = price.market
                                - normalDirectLow = price.direct_low

                        table.ui.small.sortable.celled.table
                            thead
                                tr
                                    th &nbsp;
                                    th Normal
                                    th Foil
                            tbody
                                tr
                                    td Low
                                    if normalLow > 0
                                        td.right.aligned $#{ normalLow }
                                    else
                                        td.right.aligned &#8212
                                    if foilLow > 0
                                        td.right.aligned $#{ foilLow }
                                    else
                                        td.right.aligned &#8212
                                tr
                                    td Median
                                    if normalMedian > 0
                                        td.right.aligned $#{ normalMedian }
                                    else
                                        td.right.aligned &#8212
                                    if foilMedian > 0
                                        td.right.aligned $#{ foilMedian }
                                    else
                                        td.right.aligned &#8212
                                tr
                                    td High
                                    if normalHigh > 0
                                        td.right.aligned $#{ normalHigh }
                                    else
                                        td.right.aligned &#8212
                                    if foilHigh > 0
                                        td.right.aligned $#{ foilHigh }
                                    else
                                        td.right.aligned &#8212
                                tr
                                    td Market
                                    if normalMarket > 0
                                        td.right.aligned $#{ normalMarket }
                                    else
                                        td.right.aligned &#8212
                                    if foilMarket > 0
                                        td.right.aligned $#{ foilMarket }
                                    else
                                        td.right.aligned &#8212
                                tr
                                    td Direct Low
                                    if normalDirectLow > 0
                                        td.right.aligned $#{ normalDirectLow }
                                    else
                                        td.right.aligned &#8212
                                    if foilDirectLow > 0
                                        td.right.aligned $#{ foilDirectLow }
                                    else
                                        td.right.aligned &#8212
                            tfoot
                                tr
                                    th(colspan='3')

            h3 Variations
                if card.variations.length > 0
                    p
                    .ui.link.cards
                        each variation in card.variations
                            .card
                                a.image(href="/card/" + variation.id + "?displayAs=" + displayAs + "&sortedBy=" + sortedBy + "&orderBy=" + orderBy)
                                    if variation.faces.length > 0
                                        img.medium.ui.image(src="/images/cards/" + variation.set.code + "/" + variation.language.code + "/" + variation.faces[0].id + "/art_crop.jpg")
                                    else
                                        img.medium.ui.image(src="/images/cards/" + variation.set.code + "/" + variation.language.code + "/" + variation.id + "/art_crop.jpg")
                                .content ##{variation.collector_number} &#11825; #{variation.rarity.name}
                else
                    p &#8212;

            h3 Other Printings
                if card.other_printings.length > 0
                    p
                    each printing in card.other_printings
                        a.image(href="/card/" + printing.id + "?displayAs=" + displayAs + "&sortedBy=" + sortedBy + "&orderBy=" + orderBy)
                            i(class='ss ss-' + printing.set.code + ' ss-' + printing.rarity.name.toLowerCase() + ' ss-2x') &nbsp;
                else
                    p &#8212;

            h3 Legalities
            if card.format_legalities.length > 0
                table.ui.small.celled.table
                    thead
                        tr
                            th Format
                            th Legality
                    tbody
                        each legality in card.format_legalities
                            tr
                                td #{legality.format.name}
                                td #{legality.legality.name}
                    tfoot
                        tr
                            th(colspan='2')
            else
                p &#8212;
